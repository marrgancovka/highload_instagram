# Проектирование высоконагруженных систем
Расчетно-пояснительная записка к курсовой работе по предмету "Проектирвоание высоконагруженных систем".  
## 1. Тема и целевая аудитория
### Тема
Instagram - социальная сеть для обмена фотографиями и видео
### Целевая аудитория
- Весь мир
- MAU: 2 млрд
### Функционал
- Публикация постов (фотографий и видео)
- Реакция на публикации (лайки и комментарии)
- Подписка на контент других пользователей
- Лента новостей
### Продуктовые решения
- Рекомендательный алгоритм на основе действий пользователя для показа инетерсного пользователю контента 
- Лента формируется на основе подписок пользователя и рекомендаций пользователю
- Хэштеги - для посика постов по тегам
## 2. Расчет нагрузки
### Продуктовые метрики
| Метрика                                                                   | Значение |
|---------------------------------------------------------------------------|----------|
| Месячная аудитория                                                        | 2 млрд.  |
| Суточная аудитория                                                        | 500 млн. |
| Среднее количество публикаций одним пользователем в день                  | 0,05     |
| Количество лайков одним пользователем в день                              | 8,4      |
| Среднее количество подписок на другие аккаунты одним пользователем в день | 0,1      |
| Среднее время, проведенное в день                                         | 33,9 мин |
#### Средний размер хранилища пользователя по типам
| Тип                                         | Размер       |
|---------------------------------------------|--------------|
| Данные пользователя (Имя, описание, аватар) | ~ 1 Мб       |
| Мета-данные (подписки, лайки и т.д)         | ~ 500 Кб     |
| Публикации (фотографии + видео)             | ~ 2 Гб       |
| Итог                                        | **2,1 Гб** |
### Технические метрики
#### Размер хранения в разбивке по типам данных
| Тип                      | Количество, шт | Размер, ТБ |
|--------------------------|----------------|------------|
| Фотографии + видеоролики | > 50 млрд.     | 386 823*   |
| Данные профиля           | 2 млрд         | 2 000      |
| Мета-данные              | 2 млрд         | 1 000      |  

*Исходя из того, что видеоролики составляют примерно 30% от всех публикаций, получаем, что видеороликов примерно 15 млрд, а фотографий 35 млрд.   
Общий размер публикаций = количество видеороликов * средний размер видеоролика + количество фотографий * средний размер фотографии = `15 000 000 000 * 20 Мб + 35 000 000 000 * 3 Мб = 405,000,000,000МБ = 395,507,813 ГБ
= 386,823 ТБ
** 2 000 000 000 * 500 Kб = 1 000 Тб`
#### Сетевой трафик
Так как Instagram используют по всему миру, то в разных часовых поясах будут разное пиковое время использования. Поэтому возьмем пиковое значение * 2 от среднесуточного. 
Расчет пикового значения - `(среднесуточное гбит/сутки)/86400 * 2`

| Тип                   | Суточное, Гбит/сутки | Пиковое, Гбит/с |
|-----------------------|----------------------|-----------------|
| Публикация фотографии | 2660 *               | 0,06            | 
| Публикация видео      | 4560 **              | 0.1             |
| Получение ленты       | 1 416 822 ***        | 32,8            |
| Реакция на посты      | 34 406 ****          | 0,8             |    

В сутки публикуется около 95 млн постов => 28,5 млн - видео, 66,5 - фотографии
*`66,5 млн × 5МБ=332,5 ТБ/сутки ≈ 2660 Гбит/сутки`  
** `28,5 млн×20 МБ=570 ТБ/сутки≈4560 Гбит/сутки`  
*** Допустим, что за минуту пользователь успевает посмотреть 3 поста => `33,9 мин * 500 млн * 10 Мб = 1 416 822 Гбит/сутки`
**** `500 млн * 8,4 * 1 Кб = 34 406 Гбит/сутки`
#### RPS
Расчет пикового значения - `(среднесуточное rps) * 2`

| Тип                    | Суточное, запросов в секунду | Пиковое, запросов в секунду |
|------------------------|------------------------------|-----------------------------|
| Публикация фотографии  | 752                          | 1 504                       | 
| Публикация видео       | 322                          | 644                         |
| Получение ленты        | 5 787                        | 11 574                      |
| Реакция на посты       | 48 611                       | 97 222                      |    

В секунду публикуется 1074 поста => 322 видео, 752 фото

## 3. Глобальная балансировка нагрузки


## Источники
1. https://sproutsocial.com/insights/instagram-stats/
2. https://whatsthebigdata.com/instagram-statistics/
3. https://www.socialpilot.co/instagram-marketing/instagram-stats
4. https://earthweb.com/blog/how-many-pictures-are-on-instagram/
5. https://www.statista.com/topics/1882/instagram/#topicOverview
